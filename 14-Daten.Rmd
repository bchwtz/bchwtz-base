# Daten {-}

## Taxi Trips

### Datenbeschreibung

**Variablen**

- `id`: a unique identifier for each trip
- `vendor_id`: a code indicating the provider associated with the trip record
- `pickup_datetime`: date and time when the meter was engaged
- `dropoff_datetime`: date and time when the meter was disengaged
- `passenger_count`: the number of passengers in the vehicle (driver entered value)
- `pickup_longitude`: the longitude where the meter was engaged
- `pickup_latitude`: the latitude where the meter was engaged
- `dropoff_longitude`: the longitude where the meter was disengaged
- `dropoff_latitude`: the latitude where the meter was disengaged
- `store_and_fwd_flag`: This flag indicates whether the trip record was held in vehicle memory before sending to the vendor because the vehicle did not have a connection to the server - Y=store and forward; N=not a store and forward trip
- `trip_duration`: duration of the trip in seconds

**Ergänzte Variablen**

- `osrm_distance`: the travel distance by car in kilometers as calculated by the Open Streetmap Routing Machine
- `osrm_duration`: the estimated duration for travelling the route by car in minutes as estimated by the Open Streetmap Routing Machine
- `geodesic_distance`: the geodesic distance in meters between the pickup and dropoff coordinates calculated using the method of Karney (2013)
- `weekday:` the day of the week when the trip was started

### Daten laden

Der Datensatz kann mit dem folgenden Befehl in R geladen werden:

```{r, eval = FALSE}
# Load Data
x <- read.csv("~/bchwtz/nyctaxi.csv")
```

### Ergänzungen

Die ergänzten Variablen wurden mit Hilfe des folgenden Programmcodes erzeugt.

```{r, eval = FALSE}
library(geodist)
library(osrm)

x <- head(x, 50) # Shorten the data to speed up the example

# Function to make points dataframe
make_pts <- function(x){
  pts <- data.frame(long = c(x["pickup_longitude"], x["dropoff_longitude"]), 
                    lat = c(x["pickup_latitude"], x["dropoff_latitude"]),
                    row.names = NULL)
  return(pts)
}


# Function to request route information from openstreetmap
make_dist_duration <- function(x, type=c("car","bike","foot")[1]){
  pts <- make_pts(x)
  route <- osrm::osrmRoute(loc=pts, returnclass = "sf", osrm.profile = type)
  return(c(osrm_distance=route$dist, osrm_duration=route$duration))
}


# Funtion to calculate geodesic_distance
make_geodesic_distance <- function(x){
  pickup_loc <- c(longitude=x["pickup_longitude"],
                  latitude=x["pickup_latitude"])
  dropoff_loc <- c(longitude=x["dropoff_longitude"],
                   latitude=x["dropoff_latitude"])
  geodesic_distance <- geodist::geodist(x=pickup_loc,
                                        y=dropoff_loc, 
                                        measure = "geodesic")
  return(geodesic_distance)
}

# Generate route information and add to dataset
res <- apply(x, MARGIN=1, make_dist_duration)
df <- cbind(x,t(res))

# Add day of the week to dataset
df$weekday <- weekdays(as.Date(df$pickup_datetime))

# Add geodesic distance to dataset
df$gedesic_distance <- apply(df, MARGIN=1, make_geodesic_distance)
```

### Quellen
- https://www.kaggle.com/c/nyc-taxi-trip-duration/
- https://www1.nyc.gov/site/tlc/about/tlc-trip-record-data.page

## Hauspreise


## Human Ressources

